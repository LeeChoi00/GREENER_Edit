<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">
    <resultMap type="Member" id="memberResultSet">
    	<id column="USER_ID" property="userId"/>
    	
    	<result column="USER_PWD" property="userPwd"/>
    	<result column="USER_NAME" property="userName"/>
    	<result column="NICKNAME" property="nickName"/>
    	<result column="EMAIL" property="email"/>
    	<result column="PHONE" property="phone"/>
    	<result column="BIRTH_DATE" property="birthDate"/>
    	<result column="MEMBER_STATUS" property="status"/>
    	<result column="MANAGER_YN" property="manager"/>
    	<result column="PWD_CONFIRM" property="pwdConfirm"/>
    	<result column="CREATE_DATE" property="createDate"/>
    	<result column="MODIFY_DATE" property="modifyDate"/>
    	<result column="PWD_QUESTION" property="pwdQuestion"/>
    </resultMap>

	<!-- 로그인  -->
	<select id="login" resultMap="memberResultSet">
		select *
		from member
		where user_id=#{userId} and member_status='Y'
	</select>
  
	<!-- 회원가입 -->
    <insert id="insertMember">
    	insert into member
    	values(#{userId}, #{userPwd}, #{userName}, #{nickName}, #{email}, #{phone}, #{birthDate}, default, 'N', #{pwdConfirm}, sysdate, sysdate, #{pwdQuestion})
    </insert>
    
    <!-- 아이디 중복확인 -->
    <select id="checkId" resultType="_int">
    	select count(*) 
    	from member
    	where user_id = #{inputId}
    </select>
    
    <!-- 이메일 중복확인 -->
    <select id="emailDCheck" resultType="_int">
    	select count(*)
    	from member
    	where email=#{email}
    </select>
    
    <!-- 전화번호 중복확인 -->
    <select id="checkPhone" resultType="_int">
    	select count(*)
    	from member
    	where phone=#{phone}
    </select>
    
    <!-- 닉네임 중복확인 -->
    <select id="checkNickName" resultType="_int">
    	select count(*)
    	from member
    	where nickname=#{userNickName}
    </select>
    
    <!-- 이메일로 아이디 찾기 -->
    <select id="searchIdByEmail" resultType="string">
    	select user_id
    	from member
    	where user_name=#{userName} and email=#{email}
    </select>
    
    <!-- 전화번호로 아이디 찾기 -->
    <select id="searchIdByPhone" resultType="string">
    	select user_id
    	from member
    	where user_name=#{userName} and phone=#{phone}
    </select>
    
    <!-- 비밀번호 생성 - 사용자 존재 여부 확인 -->
    <select id="emailVaild" resultType="_int">
    	select count(*)
    	from member
    	where user_id = #{userId} and email=#{email}
    </select>
    
    <!-- 비밀번호  생성 - 회원가입 질문&답 확인 -->
    <select id="newPwdQCheck" resultType="_int">
    	select count(*)
    	from member
    	where user_id=#{userId} and pwd_confirm=#{pwdConfirm} and pwd_question=#{pwdQuestion}
    </select>
    
    <!-- 비밀번호 생성 - 새 비밀번호로 db 수정-->
    <update id="updateNewPwd">
    	update member
    	set user_pwd = #{userPwd}
    	where user_id = #{userId}
    </update>
    
    <!-- 내 정보 수정 -->
    <update id="updateMember">
    	update member
    	set user_name=#{userName}, nickname=#{nickName}, email=#{email}, phone=#{phone}
    	where user_id = #{userId}
    </update>
    
    <!-- 비밀번호 변경 -->
    <update id="updatePwd">
    	update member
    	set user_pwd = #{userPwd}
    	where user_id = #{userId}
    </update>
    
    <!-- 탈퇴 -->
    <update id="deleteMember">
    	update member
    	set member_status = 'N'
    	where user_id = #{userId}
    </update>
</mapper>














